<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AgriTrade Africa â€” Investor Demo</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" referrerpolicy="no-referrer"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    :root{
      --bg:#f6fff8; --bg2:#ecfdf3;
      --card: rgba(255,255,255,.92);
      --text:#0b1220; --text-light: rgba(11,18,32,.68);
      --accent:#16a34a; --accent2:#22c55e;
      --border: rgba(11,18,32,.12);
      --shadow: 0 18px 40px rgba(11,18,32,.10);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(34,197,94,.18), transparent 55%),
        radial-gradient(800px 450px at 90% 20%, rgba(34,197,94,.14), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
    }
    .navbar{
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px;
      border-bottom:1px solid var(--border);
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(12px);
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:900;}
    .logo{
      width:34px; height:34px; border-radius:10px;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:white;
      box-shadow: 0 10px 22px rgba(11,18,32,.12);
      font-weight:900;
    }
    .nav-center{display:flex; gap:10px; align-items:center;}
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.92);
      padding:9px 12px; border-radius:12px;
      cursor:pointer;
      display:flex; gap:8px; align-items:center;
      box-shadow: 0 6px 18px rgba(11,18,32,.06);
      user-select:none;
    }
    .btn.active{outline:2px solid rgba(22,163,74,.18); border-color: rgba(22,163,74,.30)}
    .nav-right{display:flex; gap:10px; align-items:center;}

    select, input{
      border:1px solid var(--border);
      background: rgba(255,255,255,.94);
      color:var(--text);
      padding:9px 10px;
      border-radius:12px;
      outline:none;
      box-shadow: 0 6px 18px rgba(11,18,32,.06);
    }

    .layout{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:14px;
      padding:14px;
      max-width: 1350px;
      margin: 0 auto;
    }
    .panel{
      border:1px solid var(--border);
      background: rgba(255,255,255,.78);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .sidebar{padding:12px}
    .menu-title{font-size:.85rem; color:var(--text-light); margin:10px 8px 8px;}
    .menu-link{
      display:flex; align-items:center; gap:10px;
      padding:10px 10px;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
    }
    .menu-link:hover{background: rgba(22,163,74,.10)}
    .menu-link.active{background: rgba(22,163,74,.14); outline:1px solid rgba(22,163,74,.22)}
    .menu-icon{
      width:34px; height:34px; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(22,163,74,.10);
      border:1px solid rgba(22,163,74,.20);
    }

    .card{
      border:1px solid var(--border);
      background: rgba(255,255,255,.90);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      background: rgba(255,255,255,.96);
    }
    .card-title{font-weight:900; display:flex; align-items:center; gap:10px}
    .content-pad{padding:12px 14px}

    #map{height:520px; border-radius:14px; border:1px solid var(--border); overflow:hidden; background:#fff;}

    .status-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.95);
      box-shadow: 0 8px 22px rgba(11,18,32,.06);
      font-size:.85rem;
      user-select:none;
    }
    .dot{width:10px; height:10px; border-radius:99px; background:#9ca3af}
    .dot.on{background: var(--accent)}
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(11,18,32,.12);
      background: rgba(255,255,255,.92);
      font-size:.78rem;
      color: var(--text-light);
    }

    [dir="rtl"] body { direction: rtl; }
    [dir="rtl"] .navbar { flex-direction: row-reverse; }
    [dir="rtl"] .nav-center { flex-direction: row-reverse; }
    [dir="rtl"] .nav-right { flex-direction: row-reverse; }
    [dir="rtl"] .menu-link{justify-content:flex-end}
  </style>

  <script>
    // ========= GLOBALS (INLINE ONCLICK DEPENDS ON THESE) =========
    window.__AGRI = window.__AGRI || { clicks:0, section:"dashboard", lang:"en", cur:"USD" };

    const LOCALES = { en:"en-US", es:"es-ES", fr:"fr-FR", ar:"ar" };
    const RTL = new Set(["ar"]);
    const rates = { USD:1, KES:130.5, ETB:54.2, RWF:1220 };

    const I18N = {
      en:{ appName:"AgriTrade Africa", dash:"Dashboard", market:"Market", wallet:"Wallet", ai:"AI Tools", liveLog:"Live Logistics", lang:"Language", cur:"Currency" },
      es:{ appName:"AgriTrade Ãfrica", dash:"Panel", market:"Mercado", wallet:"Billetera", ai:"Herramientas IA", liveLog:"LogÃ­stica en vivo", lang:"Idioma", cur:"Moneda" },
      fr:{ appName:"AgriTrade Afrique", dash:"Tableau de bord", market:"MarchÃ©", wallet:"Portefeuille", ai:"Outils IA", liveLog:"Logistique en direct", lang:"Langue", cur:"Devise" },
      ar:{ appName:"Ø£Ø¬Ø±ÙŠØªØ±ÙŠØ¯ Ø£ÙØ±ÙŠÙ‚ÙŠØ§", dash:"Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…", market:"Ø§Ù„Ø³ÙˆÙ‚", wallet:"Ø§Ù„Ù…Ø­ÙØ¸Ø©", ai:"Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡", liveLog:"Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©", lang:"Ø§Ù„Ù„ØºØ©", cur:"Ø§Ù„Ø¹Ù…Ù„Ø©" }
    };

    function __(k){
      const d = I18N[window.__AGRI.lang] || I18N.en;
      return d[k] || (I18N.en[k] || k);
    }
    function __locale(){ return LOCALES[window.__AGRI.lang] || "en-US"; }

    function __setDir(){
      const rtl = RTL.has(window.__AGRI.lang);
      document.documentElement.setAttribute("dir", rtl ? "rtl" : "ltr");
      document.documentElement.setAttribute("lang", window.__AGRI.lang);
    }

    function __money(usd){
      const r = rates[window.__AGRI.cur] || 1;
      const v = usd * r;
      try { return new Intl.NumberFormat(__locale(), { style:"currency", currency: window.__AGRI.cur, maximumFractionDigits:2 }).format(v); }
      catch { return v.toLocaleString(__locale()) + " " + window.__AGRI.cur; }
    }

    // NAV: show/hide sections (NO delegation needed)
    window.__agri_nav = function(section){
      window.__AGRI.clicks++;
      const cc = document.getElementById("clickCount");
      if(cc) cc.textContent = String(window.__AGRI.clicks);

      window.__AGRI.section = section;
      localStorage.setItem("agri_section", section);

      document.querySelectorAll("[data-section]").forEach(s => s.style.display = "none");
      const target = document.querySelector('[data-section="'+section+'"]');
      if(target) target.style.display = "";

      document.querySelectorAll(".btn,.menu-link").forEach(x => x.classList.remove("active"));
      document.querySelectorAll('[data-nav="'+section+'"]').forEach(x => x.classList.add("active"));

      // resize map when returning to dashboard
      if(section==="dashboard") setTimeout(()=>window.__agri_map_init(), 120);
    };

    window.__agri_set_lang = function(lang){
      window.__AGRI.lang = lang;
      localStorage.setItem("agri_lang", lang);
      __setDir();
      window.__agri_render();
    };

    window.__agri_set_cur = function(cur){
      window.__AGRI.cur = cur;
      localStorage.setItem("agri_currency", cur);
      window.__agri_render();
    };

    window.__agri_render = function(){
      // basic labels
      const appName = document.getElementById("appName");
      if(appName) appName.textContent = __("appName");

      // nav text
      const d = document.getElementById("txtDash"); if(d) d.textContent = __("dash");
      const m = document.getElementById("txtMarket"); if(m) m.textContent = __("market");
      const w = document.getElementById("txtWallet"); if(w) w.textContent = __("wallet");
      const a = document.getElementById("txtAI"); if(a) a.textContent = __("ai");

      const d2 = document.getElementById("txtDash2"); if(d2) d2.textContent = __("dash");
      const m2 = document.getElementById("txtMarket2"); if(m2) m2.textContent = __("market");
      const w2 = document.getElementById("txtWallet2"); if(w2) w2.textContent = __("wallet");
      const a2 = document.getElementById("txtAI2"); if(a2) a2.textContent = __("ai");

      const liveLog = document.getElementById("txtLiveLog"); if(liveLog) liveLog.textContent = __("liveLog");

      // money demo
      const revenue = document.getElementById("revenue"); if(revenue) revenue.textContent = __money(24500);
      const wallet = document.getElementById("wallet"); if(wallet) wallet.textContent = __money(8320.50);
    };

    // Map (safe)
    let __map;
    window.__agri_map_init = function(){
      const mapEl = document.getElementById("map");
      const fb = document.getElementById("mapFallback");
      if(!mapEl) return;

      if(typeof window.L === "undefined"){
        if(fb) fb.style.display = "block";
        return;
      }

      try{
        if(__map){
          setTimeout(()=>{ try{ __map.invalidateSize(); }catch{} }, 50);
          return;
        }
        __map = L.map("map").setView([-1.2921, 36.8219], 6);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(__map);
        [
          { pos: [-1.2921, 36.8219], title: "Nairobi - Warehouse" },
          { pos: [-0.0236, 37.9062], title: "Mt. Kenya - Farm" },
          { pos: [-1.2864, 36.8172], title: "In Transit" }
        ].forEach(m => L.marker(m.pos).addTo(__map).bindPopup(m.title));
        setTimeout(()=>{ try{ __map.invalidateSize(); }catch{} }, 250);
        setTimeout(()=>{ try{ __map.invalidateSize(); }catch{} }, 800);
      }catch{
        if(fb) fb.style.display = "block";
      }
    };

    // Boot
    document.addEventListener("DOMContentLoaded", ()=>{
      // prove JS is running
      const dot = document.getElementById("jsDot");
      const txt = document.getElementById("jsText");
      if(dot) dot.classList.add("on");
      if(txt) txt.textContent = "JS: ON";

      // load saved state
      window.__AGRI.lang = localStorage.getItem("agri_lang") || "en";
      window.__AGRI.cur = localStorage.getItem("agri_currency") || "USD";
      window.__AGRI.section = localStorage.getItem("agri_section") || "dashboard";

      // set dropdowns
      const langSel = document.getElementById("langSelect");
      const curSel = document.getElementById("currency");
      if(langSel){ langSel.value = window.__AGRI.lang; langSel.onchange = ()=>window.__agri_set_lang(langSel.value); }
      if(curSel){ curSel.value = window.__AGRI.cur; curSel.onchange = ()=>window.__agri_set_cur(curSel.value); }

      __setDir();
      window.__agri_render();

      // show saved section
      window.__agri_nav(window.__AGRI.section);

      // init map
      setTimeout(()=>window.__agri_map_init(), 250);
    });
  </script>
</head>

<body>
  <div class="navbar">
    <div class="brand">
      <div class="logo">A</div>
      <div>
        <div id="appName" style="font-weight:900; line-height:1;">AgriTrade Africa</div>
        <div style="font-size:.8rem; color:var(--text-light); margin-top:2px;">Investor Demo</div>
      </div>
    </div>

    <div class="nav-center">
      <div class="btn active" data-nav="dashboard" onclick="__agri_nav('dashboard')"><i class="fa-solid fa-chart-line"></i> <span id="txtDash">Dashboard</span></div>
      <div class="btn" data-nav="market" onclick="__agri_nav('market')"><i class="fa-solid fa-store"></i> <span id="txtMarket">Market</span></div>
      <div class="btn" data-nav="wallet" onclick="__agri_nav('wallet')"><i class="fa-solid fa-wallet"></i> <span id="txtWallet">Wallet</span></div>
      <div class="btn" data-nav="ai" onclick="__agri_nav('ai')"><i class="fa-solid fa-robot"></i> <span id="txtAI">AI Tools</span></div>
    </div>

    <div class="nav-right">
      <div class="status-pill">
        <span class="dot" id="jsDot"></span>
        <span id="jsText">JS: OFF</span>
        <span class="badge" id="clickCount">0</span>
      </div>

      <select id="langSelect" title="Language">
        <option value="en">ðŸ‡ºðŸ‡¸ EN</option>
        <option value="es">ðŸ‡ªðŸ‡¸ ES</option>
        <option value="fr">ðŸ‡«ðŸ‡· FR</option>
        <option value="ar">ðŸ‡¸ðŸ‡¦ AR</option>
      </select>

      <select id="currency" title="Currency">
        <option value="USD">USD</option>
        <option value="KES">KES</option>
        <option value="ETB">ETB</option>
        <option value="RWF">RWF</option>
      </select>
    </div>
  </div>

  <div class="layout">
    <aside class="panel sidebar">
      <div class="menu-title">NAV</div>
      <div class="menu-link active" data-nav="dashboard" onclick="__agri_nav('dashboard')">
        <div class="menu-icon"><i class="fa-solid fa-chart-line"></i></div><div id="txtDash2">Dashboard</div>
      </div>
      <div class="menu-link" data-nav="market" onclick="__agri_nav('market')">
        <div class="menu-icon"><i class="fa-solid fa-store"></i></div><div id="txtMarket2">Market</div>
      </div>
      <div class="menu-link" data-nav="wallet" onclick="__agri_nav('wallet')">
        <div class="menu-icon"><i class="fa-solid fa-wallet"></i></div><div id="txtWallet2">Wallet</div>
      </div>
      <div class="menu-link" data-nav="ai" onclick="__agri_nav('ai')">
        <div class="menu-icon"><i class="fa-solid fa-robot"></i></div><div id="txtAI2">AI Tools</div>
      </div>
    </aside>

    <main>
      <section class="card" data-section="dashboard">
        <div class="card-header">
          <div class="card-title"><i class="fa-solid fa-gauge-high"></i> Dashboard</div>
          <div class="badge">Live</div>
        </div>
        <div class="content-pad">
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
            <div class="card"><div class="content-pad"><div style="color:var(--text-light);">Total Revenue</div><div style="font-size:1.6rem;font-weight:900;" id="revenue">â€”</div></div></div>
            <div class="card"><div class="content-pad"><div style="color:var(--text-light);">Wallet Balance</div><div style="font-size:1.6rem;font-weight:900;" id="wallet">â€”</div></div></div>
          </div>

          <div class="card" style="margin-top:12px;">
            <div class="card-header">
              <div class="card-title"><i class="fa-solid fa-map-location-dot"></i> <span id="txtLiveLog">Live Logistics</span></div>
              <div class="badge">Map</div>
            </div>
            <div class="content-pad">
              <div id="map"></div>
              <div id="mapFallback" style="display:none; margin-top:8px; color:var(--text-light);">
                Map library did not load, but the app is running.
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="card" data-section="market" style="display:none;">
        <div class="card-header"><div class="card-title"><i class="fa-solid fa-store"></i> Market</div><div class="badge">OK</div></div>
        <div class="content-pad" style="color:var(--text-light);">Market panel is working.</div>
      </section>

      <section class="card" data-section="wallet" style="display:none;">
        <div class="card-header"><div class="card-title"><i class="fa-solid fa-wallet"></i> Wallet</div><div class="badge">OK</div></div>
        <div class="content-pad" style="color:var(--text-light);">Wallet panel is working.</div>
      </section>

      <section class="card" data-section="ai" style="display:none;">
        <div class="card-header"><div class="card-title"><i class="fa-solid fa-robot"></i> AI Tools</div><div class="badge">OK</div></div>
        <div class="content-pad" style="color:var(--text-light);">AI Tools panel is working.</div>
      </section>
    </main>
  </div>
  <script>
(function(){
  // ---- Helpers ----
  function ensureToast(){
    if (document.getElementById("toastContainer")) return;
    const c = document.createElement("div");
    c.id = "toastContainer";
    c.style.cssText = "position:fixed;right:20px;bottom:20px;display:flex;flex-direction:column;gap:10px;z-index:99999;";
    document.body.appendChild(c);
  }
  function toast(msg){
    ensureToast();
    const c = document.getElementById("toastContainer");
    const t = document.createElement("div");
    t.style.cssText = "padding:10px 12px;border-radius:14px;border:1px solid rgba(0,0,0,.15);background:rgba(255,255,255,.96);box-shadow:0 18px 40px rgba(0,0,0,.10);max-width:420px;font-family:system-ui;";
    t.textContent = msg;
    c.appendChild(t);
    setTimeout(()=>t.remove(), 2200);
  }

  // ---- Ensure mainContent exists ----
  function getMain(){
    return document.getElementById("mainContent") || document.querySelector("main") || document.body;
  }

  // ---- Create a section if missing ----
  function ensureSection(name){
    const main = getMain();
    let sec = main.querySelector(`[data-section="${name}"]`);
    if (sec) return sec;

    sec = document.createElement("section");
    sec.className = "card";
    sec.dataset.section = name;
    sec.style.display = "none";
    sec.innerHTML = `
      <div class="card-header">
        <div class="card-title">
          <i class="fa-solid fa-layer-group"></i>
          <span style="text-transform:capitalize">${name}</span>
        </div>
        <div class="badge">Demo</div>
      </div>
      <div class="content-pad" style="color:rgba(11,18,32,.68);line-height:1.7;">
        ${name.toUpperCase()} panel is now live. (Auto-created so navigation always works.)
      </div>
    `;
    main.appendChild(sec);
    return sec;
  }

  // ---- Bulletproof navigation ----
  window.__agri_nav = window.__agri_nav || function(section){
    // Create missing target sections so nav never fails
    ensureSection(section);

    // Hide all sections then show target
    const main = getMain();
    main.querySelectorAll("[data-section]").forEach(s => s.style.display = "none");
    const target = main.querySelector(`[data-section="${section}"]`);
    if (target) target.style.display = "";

    // Highlight active buttons
    document.querySelectorAll(".menu-link, .nav-btn, .btn").forEach(x => x.classList.remove("active"));
    document.querySelectorAll(`[data-nav="${section}"]`).forEach(x => x.classList.add("active"));

    localStorage.setItem("agri_section", section);
    toast("Opened: " + section);
  };

  // ---- Force-bind clicks to everything with data-nav ----
  function bindAllNav(){
    document.querySelectorAll("[data-nav]").forEach(el=>{
      el.style.cursor = "pointer";
      el.addEventListener("click", (e)=>{
        e.preventDefault();
        e.stopPropagation();
        const section = el.getAttribute("data-nav");
        if (!section) return;
        window.__agri_nav(section);
      }, { capture:true });
    });
  }

  // ---- Ensure your common sections exist ----
  function ensureCommonSections(){
    ["dashboard","market","wallet","ai","listings","orders","logistics","disease"].forEach(ensureSection);
  }

  // ---- Run after page loads ----
  document.addEventListener("DOMContentLoaded", ()=>{
    ensureCommonSections();
    bindAllNav();

    // Restore last section (if not dashboard)
    const last = localStorage.getItem("agri_section") || "dashboard";
    window.__agri_nav(last);
  });
})();
</script>
</body>
</html>
